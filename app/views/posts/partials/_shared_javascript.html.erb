<script>

  $(document).ready(function (){
      $('[data-toggle="popover"]').popover({
          trigger: 'hover',
          html: true,
          offset: 155
      })
  })


    $(document).on("keyup", "#post_title", function () {
        render_html()
        $("#preview-post-title").text($(this).val())
    })

    $(document).on("keyup", "#post_main_url", function () {
        render_html()
    })

    $(document).on("keyup", "#post_commentries_attributes_1__description", function (){
        render_html()
    })

    $("#post_image").change(function () {
       render_html()
    })

    function render_html(){

        if ($("#post_title").val().length > 0 || $("#post_main_url").val().length > 0 || $("#post_commentries_attributes_1__description").val().length > 0 || $("#post_image")[0].files[0]) {
            $('#preview-post').html("<%= escape_javascript (render partial: 'posts/partials/preview_post') %>");

            $("#preview-post-link").empty()
            var name = $("#post_main_url").val().replace("http://", "")
            $("#preview-post-link").append("<a href=" + $("#post_main_url").val() + " class='post-link'>" + name + "</a>")

            $("#preview-post-comment-1").text($("#post_commentries_attributes_1__description").val())
            $("#preview-post-comment-one-1").text($("#post_commentries_attributes_1__description").val())

            $("#post_image")[0].files[0] ? $("#preview-post-image").attr("src", URL.createObjectURL($("#post_image")[0].files[0])) : $("#preview-post-image").attr("src", "<%= asset_path("post.png") %>")

        } else {
            $('#preview-post').html("<%= escape_javascript (render partial: 'posts/partials/empty_preview') %>");
        }
    }

    $(document).ready(function () {

        $("#post_tag_ids").select2({
            placeholder: 'Select Tags',
            containerCssClass: "form-control"
        })

        var commentries_array = [1]

        $('form').on('click', '.add_fields', function (event) {
            var commentries_count = parseInt($(".preview-commentries-count").text()) + 1
            $(".preview-commentries-count").text(commentries_count)
            commentries_array.push(commentries_count)
            $("#preview-post-comment-list").append(`<p class='comment' id='preview-post-comment-${commentries_count}'></p>`)

            var regexp;
            regexp = new RegExp($(this).data('id'), 'g');
            $('.fields').append($(this).data('fields').replace(regexp, commentries_count));
            return event.preventDefault();
        });

        var i = 1

        while (i <= commentries_array.length) {

            $(document).on("keyup", "#post_commentries_attributes_" + i + "__description", function () {
                $("p#preview-post-comment-" + 1).text($(this).val())
                $("p#preview-post-comment-one-" + 1).text($(this).val().slice(0, 50))
            })

            i = i + 1
        }

    })
</script>