<div class="post-list position-relative">
  <% if @posts.size > 0 %>
    <!-- class="empty-post" for empty layout -->
    <div class="title_wrap">
      <h3 class="title">Hi <%= current_user.first_name %>! Here are your posts</h3>
    </div>
    <div class="list">
      <form id="posts-search-form" method="get" action="/posts">
        <div class="form-group search-wrap position-relative">
            <span class="icon">
                <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="14.5" cy="14.5" r="9.5" stroke="#6ABEF8" stroke-width="2"/>
                    <path d="M21 22L25.7929 26.7929" stroke="#6ABEF8" stroke-width="2"/>
                </svg>
            </span>
          <input type="text" class="form-control" id="search-bar" name="search" placeholder="Search for posts..."/>
        </div>
      </form>

      <div class="row">
        <div class="col-6 left-column">
          <div class="dropdown form-group">
            <label class="tag-label">Tags</label>
            <form action="/posts" method="get">
              <select id="customSelectPostTag">
               <% current_company.tags.each do |tag| %>
                  <option value="<%= tag.id %>"><%= tag.name %></option>
                <% end %>
              </select>
            </form>
          </div>
        </div>
        <div class="col-6 right-column">
          <div class="tags-list">
            <label class="tag-label">Selected Tags</label>
            <div class="badge_wrap" id="selected_post_tag"></div>
          </div>
        </div>
      </div>

      <div id="posts-list">
        <%= render "posts/partials/index" %>
      </div>

    </div>
  <% else %>
    <div class="empty-list">
      <div class="home_wrap">
        <div class="center-elem">
          <svg width="144" height="186" viewBox="0 0 144 186" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="72" cy="72.4585" r="71.5" fill="#F7F9FC"/>
            <rect x="43.9505" y="71.0012" width="70" height="98" rx="7" transform="rotate(2.5 43.9505 71.0012)" fill="#F9FAFC" stroke="#6D7684" stroke-width="2"/>
            <rect x="2.33604" y="65.1391" width="74" height="102" rx="9" transform="rotate(-7.5 2.33604 65.1391)" fill="#FAFAFA" stroke="#6D7684" stroke-width="2"/>
            <path d="M4.50222 73.9316C3.92552 69.5511 7.00909 65.5325 11.3896 64.9558L66.9105 57.6463C71.291 57.0696 75.3095 60.1532 75.8862 64.5337L77.8441 79.4053L6.46011 88.8032L4.50222 73.9316Z" fill="#EEEEEE"/>
            <rect x="90.3662" y="59.6016" width="3" height="10" rx="1.5" transform="rotate(82.5 90.3662 59.6016)" fill="#6D7684"/>
            <rect x="62.9697" y="43.0356" width="3" height="10" rx="1.5" transform="rotate(-7.5 62.9697 43.0356)" fill="#6D7684"/>
            <rect x="80.5474" y="45.7646" width="3" height="10" rx="1.5" transform="rotate(37.5 80.5474 45.7646)" fill="#6D7684"/>
            <rect x="13.9224" y="91.8555" width="58" height="4" rx="2" transform="rotate(-7.5 13.9224 91.8555)" fill="#DCDCDC"/>
            <rect x="16.5327" y="111.684" width="58" height="4" rx="2" transform="rotate(-7.5 16.5327 111.684)" fill="#DCDCDC"/>
            <rect x="19.1431" y="131.513" width="58" height="4" rx="2" transform="rotate(-7.5 19.1431 131.513)" fill="#DCDCDC"/>
            <rect x="14.9663" y="99.7871" width="21" height="4" rx="2" transform="rotate(-7.5 14.9663 99.7871)" fill="#EEEEEE"/>
            <rect x="17.5771" y="119.616" width="21" height="4" rx="2" transform="rotate(-7.5 17.5771 119.616)" fill="#EEEEEE"/>
            <rect x="20.1875" y="139.445" width="21" height="4" rx="2" transform="rotate(-7.5 20.1875 139.445)" fill="#EEEEEE"/>
          </svg>
          <p>no posts yet</p>
          <a class="btn btn-primary" href="/posts/new">Create a new post</a>
        </div>
      </div>
    </div>
  <% end %>
</div>


<script>

    $(document).ready(function () {
        <% @posts.each do |post| %>
        $(document).on("click", "#post-edit-delete-<%= post.id %>", function () {
            var classes = $("#post-cards-<%= post.id %>").attr("class")

            if (classes.split(" ").includes('show-post-option')) {
                $("#post-cards-<%= post.id %>").removeClass("show-post-option")
            } else {
                $("#post-cards-<%= post.id %>").addClass("show-post-option")
            }
        })
        <% end %>


        $('#posts-search-form #search-bar').keyup(function () {
            $.get($("#posts-search-form").attr("actions"), $("#posts-search-form").serialize(), null, "script")
        })
    })

    // Cycling through the commentries

    <% @posts.each do |post| %>

    for (var i = 0; i < <%= post.commentries.size %>; i++) {
        $(".comment-<%= post.id %>-<%= post.commentries.size %>-" + i).hide()
    }

    $(".comment-<%= post.id %>-<%= post.commentries.size %>-0").show()

    $("#post-next-commentry-<%= post.id %>").click(function () {

        var cycle_count = parseInt($("#post-commetries-count-<%= post.id %>").text()) + 1
        $("#post-commetries-count-<%= post.id %>").text(cycle_count)

        for (var i = 0; i < cycle_count; i++) {
            $(".comment-<%= post.id %>-<%= post.commentries.size %>-" + i).show()
        }

        if(cycle_count >= <%= post.commentries.size %>){
            $(this).hide()
        }
    })
    <% end %>
</script>


<%= render "shared/custom-multiselect" %>
<%= render "shared/custom" %>